<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mytijian.mediator.report.DAO.SyncExamReportMapper">
  <resultMap id="BaseResultMap" type="com.mytijian.mediator.api.dto.SyncExamReportDto">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Aug 15 11:35:35 CST 2016.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="gmt_created" jdbcType="TIMESTAMP" property="gmtCreated" />
    <result column="gmt_modified" jdbcType="TIMESTAMP" property="gmtModified" />
    <result column="hospital_id" jdbcType="INTEGER" property="hospitalId" />
    <result column="report_no" jdbcType="VARCHAR" property="reportNo" />
    <result column="order_num" jdbcType="VARCHAR" property="orderNum" />
    <result column="idcard" jdbcType="VARCHAR" property="idcard" />
    <result column="exam_time" jdbcType="VARCHAR" property="examTime" />
    <result column="report_time" jdbcType="VARCHAR" property="reportTime" />
    <result column="mobile" jdbcType="VARCHAR" property="mobile" />
    <result column="company_name" jdbcType="VARCHAR" property="companyName" />
    <result column="state" jdbcType="VARCHAR" property="state" />
  </resultMap>
  <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="com.mytijian.mediator.api.dto.SyncExamReportDto">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Aug 15 11:35:35 CST 2016.
    -->
    <result column="report_context" jdbcType="LONGVARCHAR" property="reportContext" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Aug 15 11:35:35 CST 2016.
    -->
    id, gmt_created, gmt_modified, hospital_id, report_no, order_num, idcard, exam_time, 
    report_time, mobile, company_name, state
  </sql>
  <sql id="Blob_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Aug 15 11:35:35 CST 2016.
    -->
    report_context
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="ResultMapWithBLOBs">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Aug 15 11:35:35 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from tb_sync_exam_report
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Aug 15 11:35:35 CST 2016.
    -->
    delete from tb_sync_exam_report
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.mytijian.mediator.api.dto.SyncExamReportDto" useGeneratedKeys="true" keyProperty="id">
    insert into tb_sync_exam_report (gmt_created, gmt_modified, hospital_id, 
      report_no, order_num, idcard, 
      exam_time, report_time, mobile, 
      company_name, state, report_context
      )
    values (now(), now(), #{hospitalId,jdbcType=INTEGER}, 
      #{reportNo,jdbcType=VARCHAR}, #{orderNum,jdbcType=VARCHAR}, #{idcard,jdbcType=VARCHAR}, 
      #{examTime,jdbcType=VARCHAR}, #{reportTime,jdbcType=VARCHAR}, #{mobile,jdbcType=VARCHAR}, 
      #{companyName,jdbcType=VARCHAR}, #{state,jdbcType=VARCHAR}, #{reportContext,jdbcType=LONGVARCHAR}
      )
  </insert>
  
  <update id="updateByPrimaryKeySelective" parameterType="com.mytijian.mediator.api.dto.SyncExamReportDto">
    update tb_sync_exam_report
    <set>
        gmt_modified = now(),
      <if test="hospitalId != null">
        hospital_id = #{hospitalId,jdbcType=INTEGER},
      </if>
      <if test="reportNo != null">
        report_no = #{reportNo,jdbcType=VARCHAR},
      </if>
      <if test="orderNum != null">
        order_num = #{orderNum,jdbcType=VARCHAR},
      </if>
      <if test="idcard != null">
        idcard = #{idcard,jdbcType=VARCHAR},
      </if>
      <if test="examTime != null">
        exam_time = #{examTime,jdbcType=VARCHAR},
      </if>
      <if test="reportTime != null">
        report_time = #{reportTime,jdbcType=VARCHAR},
      </if>
      <if test="mobile != null">
        mobile = #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="companyName != null">
        company_name = #{companyName,jdbcType=VARCHAR},
      </if>
      <if test="state != null">
        state = #{state,jdbcType=VARCHAR},
      </if>
      <if test="reportContext != null">
        report_context = #{reportContext,jdbcType=LONGVARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="com.mytijian.mediator.api.dto.SyncExamReportDto">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Aug 15 11:35:35 CST 2016.
    -->
    update tb_sync_exam_report
    set 
      gmt_modified = now(),
      hospital_id = #{hospitalId,jdbcType=INTEGER},
      report_no = #{reportNo,jdbcType=VARCHAR},
      order_num = #{orderNum,jdbcType=VARCHAR},
      idcard = #{idcard,jdbcType=VARCHAR},
      exam_time = #{examTime,jdbcType=VARCHAR},
      report_time = #{reportTime,jdbcType=VARCHAR},
      mobile = #{mobile,jdbcType=VARCHAR},
      company_name = #{companyName,jdbcType=VARCHAR},
      state = #{state,jdbcType=VARCHAR},
      report_context = #{reportContext,jdbcType=LONGVARCHAR}
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.mytijian.mediator.api.dto.SyncExamReportDto">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Aug 15 11:35:35 CST 2016.
    -->
    update tb_sync_exam_report
    set 
      gmt_modified = now(),
      hospital_id = #{hospitalId,jdbcType=INTEGER},
      report_no = #{reportNo,jdbcType=VARCHAR},
      order_num = #{orderNum,jdbcType=VARCHAR},
      idcard = #{idcard,jdbcType=VARCHAR},
      exam_time = #{examTime,jdbcType=VARCHAR},
      report_time = #{reportTime,jdbcType=VARCHAR},
      mobile = #{mobile,jdbcType=VARCHAR},
      company_name = #{companyName,jdbcType=VARCHAR},
      state = #{state,jdbcType=VARCHAR}
    where id = #{id,jdbcType=BIGINT}
  </update>
  
  <select id="getSyncExamReports" resultMap="ResultMapWithBLOBs">
	select <include refid="Base_Column_List" />
   			,
   			<include refid="Blob_Column_List" /> 
   	from tb_sync_exam_report
   	<where>
   		<if test="hospitalId!=null">
   			hospital_id = #{hospitalId,jdbcType=INTEGER}
   		</if>
   		<if test="state!=null and state!=''">
   			and state = #{state,jdbcType=VARCHAR}
   		</if>
   	</where>
   	limit #{startIndex}, #{pageSize}
  </select>  

  <select id="getSyncExamReportsByStartIndex" resultMap="ResultMapWithBLOBs">
  	select <include refid="Base_Column_List" />
   			,
   			<include refid="Blob_Column_List" /> 
   	from tb_sync_exam_report
   	where
   		id <![CDATA[ > ]]> #{startIndex}
   		<if test="hospitalId!=null">
   			and hospital_id = #{hospitalId,jdbcType=INTEGER}
   		</if>
   	limit 0, #{pageSize}
   		
  </select>

  <delete id="delDoneSyncExamReport">
	delete from tb_sync_exam_report where hospital_id=#{hospitalId} and report_no=#{reportNo}
		and id <![CDATA[<=]]>#{examReportId}
  </delete>

  <select id="selectSyncExamReportIdList" resultType="java.lang.Long">
  	select id 
  	from tb_sync_exam_report
  	<where>
  		<if test="queryParam.hospitalId != null">
  			hospital_id = #{queryParam.hospitalId}
		</if>
  		<if test="queryParam.state != null">
  			and state = #{queryParam.state}
		</if>
  	</where>
  	limit #{offset} , #{size}
  </select>

  <update id="updateStatusBatchByIds">
	update tb_sync_exam_report set gmt_modified = now(), state = #{status}
		where id in
		<foreach collection="ids" index="index" item="id" open="("
			separator="," close=")">
			#{id}
		</foreach>
  </update>
  
  <delete id="deleteBatchByIds">
	delete from tb_sync_exam_report
		where id in
		<foreach collection="ids" index="index" item="id" open="("
			separator="," close=")">
			#{id}
		</foreach>
  </delete>

  <select id="selectMaxId" resultType="Integer">
  	select max(id) from tb_sync_exam_report
  </select>
  
  <delete id="deleteDoneExamReportWithNDaysAgo">
  	delete from tb_sync_exam_report
  	where 
  		state = 'DONE'
  	AND
  		 gmt_created <![CDATA[<=]]> #{date} 
  </delete>
</mapper>